<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EscolaShop - Útiles Escolares</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" />
  <style>
    :root {
      --primary-color: #4a90e2;
      --secondary-color: #50c878;
      --accent-color: #ffb347;
    }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f8f9fa;
    }

    .navbar-brand {
      font-weight: bold;
      font-size: 1.5rem;
      color: var(--primary-color) !important;
    }

    .hero-section {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      padding: 60px 0;
      margin-bottom: 30px;
    }

    .product-card {
      transition: transform 0.3s, box-shadow 0.3s;
      height: 100%;
      border: none;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    }

    .product-img {
      height: 200px;
      object-fit: cover;
      border-radius: 8px;
    }

    .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    }

    .login-card {
      border: none;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    }

    .category-badge {
      cursor: pointer;
      transition: all 0.3s;
    }

    .category-badge:hover {
      transform: scale(1.05);
    }

    .category-badge.active {
      background-color: var(--primary-color) !important;
      color: white !important;
    }

    .btn-primary {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
    }

    .btn-primary:hover {
      background-color: #3a7bc8;
    }

    .btn-success {
      background-color: var(--secondary-color);
      border-color: var(--secondary-color);
    }

    .order-summary {
      background-color: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
    }
  </style>
</head>
<body>
  <!-- Login -->
  <div id="loginScreen" class="login-container">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-5">
          <div class="card login-card">
            <div class="card-body p-5 text-center">
              <i class="bi bi-bag-check-fill" style="font-size: 4rem; color: var(--primary-color)"></i>
              <h2 class="mt-3">EscolaShop</h2>
              <p class="text-muted mb-4">Tu tienda de útiles escolares</p>
              <form id="loginForm">
                <div class="mb-3 text-start">
                  <label class="form-label">Usuario</label>
                  <input type="text" class="form-control" id="username" placeholder="admin o cliente" required />
                  <small class="text-muted">Usuarios: admin / cliente</small>
                </div>
                <div class="mb-3 text-start">
                  <label class="form-label">Contraseña</label>
                  <input type="password" class="form-control" id="password" placeholder="123456" required />
                  <small class="text-muted">Contraseña: 123456</small>
                </div>
                <button type="submit" class="btn btn-primary w-100 py-2">
                  <i class="bi bi-box-arrow-in-right me-2"></i>Iniciar Sesión
                </button>
              </form>
              <div id="loginError" class="alert alert-danger mt-3 d-none">
                Credenciales incorrectas
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main App -->
  <div id="mainApp" class="d-none">
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
      <div class="container">
        <a class="navbar-brand" href="#">
          <i class="bi bi-bag-check-fill me-2"></i>EscolaShop
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto align-items-center">
            <li class="nav-item">
              <a class="nav-link" href="#" onclick="showProducts()"><i class="bi bi-shop me-1"></i>Productos</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" onclick="showOrders()"><i class="bi bi-receipt me-1"></i>Mis Pedidos</a>
            </li>
            <li class="nav-item ms-3">
              <button class="btn btn-outline-primary position-relative" onclick="toggleCart()">
                <i class="bi bi-cart3"></i>
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="cartCount">0</span>
              </button>
            </li>
            <li class="nav-item ms-2">
              <span class="navbar-text me-2">
                <i class="bi bi-person-circle me-1"></i>
                <span id="currentUser"></span>
              </span>
            </li>
            <li class="nav-item">
              <button class="btn btn-outline-danger btn-sm" onclick="logout()">
                <i class="bi bi-box-arrow-right"></i>
              </button>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Hero -->
    <div class="hero-section text-center">
      <h1 class="display-5 fw-bold mb-3">¡Todo para el regreso a clases!</h1>
      <p class="lead">Encuentra los mejores útiles escolares al mejor precio</p>
    </div>

    <!-- Productos -->
    <div class="container mb-5" id="productsSection">
      <div class="row mb-4">
        <div class="col-12">
          <h5 class="mb-3">Categorías</h5>
          <div class="d-flex flex-wrap gap-2">
            <span class="badge bg-secondary category-badge active" onclick="filterCategory('all')">Todas</span>
            <span class="badge bg-secondary category-badge" onclick="filterCategory('Escritura')">Escritura</span>
            <span class="badge bg-secondary category-badge" onclick="filterCategory('Arte')">Arte</span>
            <span class="badge bg-secondary category-badge" onclick="filterCategory('Organización')">Organización</span>
            <span class="badge bg-secondary category-badge" onclick="filterCategory('Papelería')">Papelería</span>
          </div>
        </div>
      </div>
      <div class="row g-4" id="productsGrid"></div>
    </div>

    <!-- Pedidos -->
    <div class="container my-5 d-none" id="ordersSection">
      <h2 class="mb-4"><i class="bi bi-receipt me-2"></i>Mis Pedidos</h2>
      <div id="ordersList"></div>
    </div>
  </div>

  <!-- Carrito -->
  <div class="offcanvas offcanvas-end" tabindex="-1" id="cartOffcanvas">
    <div class="offcanvas-header">
      <h5><i class="bi bi-cart3 me-2"></i>Carrito</h5>
      <button class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body">
      <div id="cartItems"></div>
      <div id="cartSummary" class="mt-4"></div>
    </div>
  </div>

  <!-- Modal Producto -->
  <div class="modal fade" id="productModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 id="productModalTitle"></h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="productModalBody"></div>
      </div>
    </div>
  </div>

  <!-- Modal Checkout -->
  <div class="modal fade" id="checkoutModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header"><h5>Finalizar Compra</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
          <form id="checkoutForm">
            <div class="mb-3">
              <label class="form-label">Dirección de Envío</label>
              <textarea class="form-control" rows="3" required></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">Método de Pago</label>
              <select class="form-select" required>
                <option value="">Seleccionar...</option>
                <option>Efectivo contra entrega</option>
                <option>Tarjeta de crédito</option>
                <option>Transferencia bancaria</option>
              </select>
            </div>
            <div id="checkoutSummary" class="order-summary mb-3"></div>
            <button type="submit" class="btn btn-success w-100"><i class="bi bi-check-circle me-2"></i>Confirmar Pedido</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const users = {
      admin: { password: "123456", name: "Administrador" },
      cliente: { password: "123456", name: "Cliente" },
    };

    const products = [
      { id: 1, name: "Cuaderno Universitario", price: 25, category: "Papelería", image: "img/cuaderno.jpg", description: "Cuaderno de 100 hojas rayadas, tamaño carta.", stock: 50 },
      { id: 2, name: "Set de Bolígrafos", price: 15, category: "Escritura", image: "img/boligrafos.jpg", description: "Pack de 8 bolígrafos de diferentes colores.", stock: 100 },
      { id: 3, name: "Lápices HB (12 unidades)", price: 12, category: "Escritura", image: "img/lapices.jpg", description: "Caja con 12 lápices HB de alta calidad.", stock: 80 },
      { id: 4, name: "Borrador Blanco", price: 3, category: "Escritura", image: "img/borrador.jpg", description: "Borrador de larga duración.", stock: 150 },
      { id: 5, name: "Sacapuntas Metálico", price: 8, category: "Escritura", image: "img/sacapuntas.jpg", description: "Sacapuntas doble de metal.", stock: 90 },
      { id: 6, name: "Crayones de Colores x24", price: 45, category: "Arte", image: "img/colores.jpg", description: "Set de 24 crayones de colores de premium.", stock: 40 },
      { id: 7, name: "Marcadores Permanentes", price: 20, category: "Escritura", image: "img/marcadores.jpg", description: "Set de 12 marcadores permanentes.", stock: 60 },
      { id: 8, name: "Tijeras Escolares", price: 18, category: "Arte", image: "img/tijeras.jpg", description: "Tijeras con punta redonda, seguras para niños.", stock: 70 },
      { id: 9, name: "Pegamento Líquido", price: 10, category: "Arte", image: "img/pegamento.jpg", description: "Pegamento blanco 250ml.", stock: 85 },
      { id: 10, name: "Carpeta con Anillos", price: 35, category: "Organización", image: "img/carpeta.jpg", description: "Carpeta de 3 anillos tamaño carta.", stock: 45 },
      { id: 11, name: "Regla de 30cm", price: 5, category: "Arte", image: "img/regla.jpg", description: "Regla plástica transparente.", stock: 120 },
      { id: 12, name: "Mochila Escolar", price: 150, category: "Organización", image: "img/mochila.jpg", description: "Mochila resistente con múltiples compartimentos.", stock: 25 },
    ];

    let currentUser = null, cart = [], orders = [], currentFilter = "all";

    // === LOGIN ===
    document.getElementById("loginForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();

      if (users[username] && users[username].password === password) {
        currentUser = users[username];
        document.getElementById("loginScreen").classList.add("d-none");
        document.getElementById("mainApp").classList.remove("d-none");
        document.getElementById("currentUser").textContent = currentUser.name;
        renderProducts(); // ✅ muestra productos
      } else {
        document.getElementById("loginError").classList.remove("d-none");
      }
    });

    function logout() {
      currentUser = null;
      cart = [];
      document.getElementById("loginScreen").classList.remove("d-none");
      document.getElementById("mainApp").classList.add("d-none");
      document.getElementById("loginForm").reset();
      document.getElementById("loginError").classList.add("d-none");
    }

    // === PRODUCTOS ===
    function renderProducts() {
      const grid = document.getElementById("productsGrid");
      const filtered =
        currentFilter === "all"
          ? products
          : products.filter((p) => p.category === currentFilter);

      if (!filtered.length) {
        grid.innerHTML = `<div class="text-center text-muted py-5"><i class="bi bi-box-seam" style="font-size:3rem;"></i><p>No hay productos disponibles</p></div>`;
        return;
      }

      grid.innerHTML = filtered
        .map(
          (p) => `
        <div class="col-md-6 col-lg-3">
          <div class="card product-card">
            <img src="${p.image}" class="product-img" alt="${p.name}" loading="lazy">
            <div class="card-body">
              <h6>${p.name}</h6>
              <p class="text-muted small">${p.category}</p>
              <div class="d-flex justify-content-between align-items-center">
                <span class="h5 text-primary">Q${p.price.toFixed(2)}</span>
                <small class="text-muted">Stock: ${p.stock}</small>
              </div>
              <div class="d-grid gap-2 mt-3">
                <button class="btn btn-sm btn-outline-primary" onclick="showProductDetail(${p.id})"><i class="bi bi-eye me-1"></i>Ver</button>
                <button class="btn btn-sm btn-primary" onclick="addToCart(${p.id})"><i class="bi bi-cart-plus me-1"></i>Agregar</button>
              </div>
            </div>
          </div>
        </div>`
        )
        .join("");
    }

    function filterCategory(cat) {
      currentFilter = cat;
      document.querySelectorAll(".category-badge").forEach((b) => b.classList.remove("active"));
      event.target.classList.add("active");
      renderProducts();
    }

    function showProductDetail(id) {
      const p = products.find((x) => x.id === id);
      document.getElementById("productModalTitle").textContent = p.name;
      document.getElementById("productModalBody").innerHTML = `
        <div class="row">
          <div class="col-md-5">
            <img src="${p.image}" class="img-fluid rounded">
          </div>
          <div class="col-md-7">
            <p><b>Categoría:</b> ${p.category}</p>
            <p>${p.description}</p>
            <p><b>Precio:</b> <span class='text-primary h4'>Q${p.price.toFixed(2)}</span></p>
            <button class="btn btn-primary" onclick="addToCart(${p.id});bootstrap.Modal.getInstance(document.getElementById('productModal')).hide();"><i class='bi bi-cart-plus me-2'></i>Agregar al carrito</button>
          </div>
        </div>`;
      new bootstrap.Modal(document.getElementById("productModal")).show();
    }

    // === CARRITO ===
    function addToCart(id) {
      const p = products.find((x) => x.id === id);
      const c = cart.find((i) => i.id === id);
      if (c) {
        if (c.quantity < p.stock) c.quantity++;
        else return alert("No hay suficiente stock disponible");
      } else cart.push({ ...p, quantity: 1 });
      updateCart();
      showToast("Producto agregado");
    }

    function removeFromCart(id) {
      cart = cart.filter((i) => i.id !== id);
      updateCart();
    }

    function updateQuantity(id, change) {
      const item = cart.find((i) => i.id === id);
      if (item) {
        item.quantity += change;
        if (item.quantity <= 0) removeFromCart(id);
        else if (item.quantity > item.stock) item.quantity = item.stock;
        updateCart();
      }
    }

    function updateCart() {
      document.getElementById("cartCount").textContent = cart.reduce((a, b) => a + b.quantity, 0);
      const items = document.getElementById("cartItems");
      const summary = document.getElementById("cartSummary");
      if (!cart.length) {
        items.innerHTML = '<div class="text-center text-muted py-5"><i class="bi bi-cart-x" style="font-size:3rem;"></i><p>Tu carrito está vacío</p></div>';
        summary.innerHTML = "";
        return;
      }
      items.innerHTML = cart
        .map(
          (i) => `
        <div class='d-flex justify-content-between align-items-center mb-3 border-bottom pb-2'>
          <div>
            <b>${i.name}</b><br><small>Q${i.price.toFixed(2)} c/u</small>
          </div>
          <div>
            <button class='btn btn-sm btn-outline-secondary' onclick='updateQuantity(${i.id},-1)'>-</button>
            <span class='mx-2'>${i.quantity}</span>
            <button class='btn btn-sm btn-outline-secondary' onclick='updateQuantity(${i.id},1)'>+</button>
            <button class='btn btn-sm btn-danger ms-2' onclick='removeFromCart(${i.id})'><i class='bi bi-trash'></i></button>
          </div>
        </div>`
        )
        .join("");

      const total = cart.reduce((a, b) => a + b.price * b.quantity, 0);
      summary.innerHTML = `
        <div class='order-summary'>
          <div class='d-flex justify-content-between mb-2'><span>Subtotal:</span><b>Q${total.toFixed(2)}</b></div>
          <div class='d-flex justify-content-between mb-2'><span>Envío:</span><b>Q15.00</b></div>
          <hr>
          <div class='d-flex justify-content-between mb-3'><h5>Total:</h5><h5 class='text-primary'>Q${(total + 15).toFixed(2)}</h5></div>
          <button class='btn btn-success w-100' onclick='openCheckout()'><i class='bi bi-credit-card me-2'></i>Proceder al Pago</button>
        </div>`;
    }

    function toggleCart() {
      new bootstrap.Offcanvas(document.getElementById("cartOffcanvas")).show();
    }

    function openCheckout() {
      const total = cart.reduce((a, b) => a + b.price * b.quantity, 0);
      document.getElementById("checkoutSummary").innerHTML = `
        <h6>Resumen del Pedido</h6>
        <div class='d-flex justify-content-between'><span>Subtotal:</span><b>Q${total.toFixed(2)}</b></div>
        <div class='d-flex justify-content-between'><span>Envío:</span><b>Q15.00</b></div>
        <hr>
        <div class='d-flex justify-content-between'><strong>Total:</strong><strong class='text-success'>Q${(total + 15).toFixed(2)}</strong></div>`;
      new bootstrap.Modal(document.getElementById("checkoutModal")).show();
    }

    document.getElementById("checkoutForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const order = {
        id: orders.length + 1,
        date: new Date().toLocaleString(),
        items: [...cart],
        total: cart.reduce((a, b) => a + b.price * b.quantity, 0) + 15,
      };
      orders.push(order);
      cart = [];
      updateCart();
      bootstrap.Modal.getInstance(document.getElementById("checkoutModal")).hide();
      showOrders();
      showToast("¡Compra realizada con éxito!");
    });

    // === PEDIDOS ===
    function showOrders() {
      document.getElementById("productsSection").classList.add("d-none");
      document.getElementById("ordersSection").classList.remove("d-none");
      const list = document.getElementById("ordersList");
      if (!orders.length) {
        list.innerHTML = '<div class="text-center text-muted py-5"><i class="bi bi-inbox" style="font-size:3rem;"></i><p>No tienes pedidos aún</p></div>';
        return;
      }
      list.innerHTML = orders
        .map(
          (o) => `
        <div class='card mb-3'>
          <div class='card-header'><b>Pedido #${o.id}</b> <small class='text-muted ms-3'>${o.date}</small></div>
          <div class='card-body'>
            <table class='table table-sm'>
              <thead><tr><th>Producto</th><th>Cant.</th><th>Precio</th><th>Subtotal</th></tr></thead>
              <tbody>${o.items
                .map(
                  (i) =>
                    `<tr><td>${i.name}</td><td>${i.quantity}</td><td>Q${i.price.toFixed(2)}</td><td>Q${(
                      i.price * i.quantity
                    ).toFixed(2)}</td></tr>`
                )
                .join("")}</tbody>
            </table>
            <div class='text-end'><h5>Total: <span class='text-success'>Q${o.total.toFixed(
              2
            )}</span></h5></div>
          </div>
        </div>`
        )
        .join("");
    }

    function showProducts() {
      document.getElementById("productsSection").classList.remove("d-none");
      document.getElementById("ordersSection").classList.add("d-none");
    }

    // === TOAST ===
    function showToast(msg) {
      const t = document.createElement("div");
      t.className = "position-fixed bottom-0 end-0 p-3";
      t.style.zIndex = "9999";
      t.innerHTML = `<div class='toast show'><div class='toast-body bg-success text-white'><i class='bi bi-check-circle me-2'></i>${msg}</div></div>`;
      document.body.appendChild(t);
      setTimeout(() => t.remove(), 3000);
    }
  </script>
</body>
</html>
